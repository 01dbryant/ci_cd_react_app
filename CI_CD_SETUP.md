# CI/CD Setup Instructions

## GitHub Actions Workflow Overview

The workflow includes two jobs:

### 1. **CI: Build and Test**
- Runs on every push and pull request to `main`
- Steps:
  - Checkout code
  - Setup Node.js (v20)
  - Install dependencies
  - Run ESLint
  - Build the Vite project
  - Run Jest tests with coverage
  - Upload coverage and build artifacts

### 2. **CD: Deploy to Vercel**
- Runs only after CI passes
- Only triggers on pushes to `main` (not PRs)
- Deploys to Vercel production

## Setup Instructions

### Step 1: Install Vercel CLI (Local Setup)
```bash
npm install -g vercel
```

### Step 2: Link Your Project to Vercel
```bash
cd ecommerce
vercel login
vercel link
```

This will create a `.vercel` folder with project configuration.

### Step 3: Get Vercel Credentials

Run this command to get your tokens:
```bash
vercel --token
```

Or get them from:
1. **VERCEL_TOKEN**: https://vercel.com/account/tokens
   - Create a new token with appropriate permissions

2. **VERCEL_ORG_ID** and **VERCEL_PROJECT_ID**:
   - After running `vercel link`, check `.vercel/project.json`
   - Or find them in your Vercel project settings

### Step 4: Add GitHub Secrets

Go to your GitHub repository:
1. Settings → Secrets and variables → Actions
2. Click "New repository secret"
3. Add these three secrets:

   - `VERCEL_TOKEN`: Your Vercel access token
   - `VERCEL_ORG_ID`: Your Vercel organization/team ID
   - `VERCEL_PROJECT_ID`: Your Vercel project ID

### Step 5: Configure Jest (if needed)

Ensure you have Jest dependencies installed:
```bash
cd ecommerce
npm install --save-dev jest @testing-library/react @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom babel-jest @babel/preset-env @babel/preset-react identity-obj-proxy
```

### Step 6: Create Babel Config (if missing)

Create `ecommerce/babel.config.js`:
```javascript
export default {
  presets: [
    ['@babel/preset-env', { targets: { node: 'current' } }],
    ['@babel/preset-react', { runtime: 'automatic' }],
  ],
};
```

### Step 7: Update Jest Config Path

Your `jest.config.js` references `<rootDir>/src/test/setupTests.js` but your setup file is at `__test__/setupTests.js`. Either:

Option A: Move the test setup file:
```bash
mkdir -p ecommerce/src/test
mv __test__/setupTests.js ecommerce/src/test/
```

Option B: Update `jest.config.js`:
```javascript
setupFilesAfterEnv: ['<rootDir>/__test__/setupTests.js'],
```

### Step 8: Commit and Push

```bash
git add .
git commit -m "Add CI/CD pipeline with GitHub Actions and Vercel"
git push origin main
```

## Workflow Behavior

✅ **On Pull Requests**: Runs CI tests but does NOT deploy
✅ **On Push to Main**: Runs CI tests AND deploys to Vercel if tests pass
❌ **If Tests Fail**: Deployment is blocked

## Monitoring

- View workflow runs: GitHub repository → Actions tab
- View deployments: Vercel dashboard
- Check coverage reports: Download from workflow artifacts

## Troubleshooting

### Tests fail locally but not in CI
- Ensure all dependencies are in `package.json`
- Check Node.js version compatibility

### Deployment fails
- Verify all three Vercel secrets are set correctly
- Check Vercel project settings and permissions
- Ensure `vercel-project-id` matches your project

### Coverage upload fails
- This is optional; the workflow continues even if upload fails
- Ensure the `coverage/` directory is generated by Jest
